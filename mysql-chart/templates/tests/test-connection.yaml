apiVersion: v1
kind: Pod
metadata:
  name: "{{ include "mysql-chart.fullname" . }}-test-host-connection"
  labels:
    {{- include "mysql-chart.labels" . | nindent 4 }}
  annotations:
    "helm.sh/hook-delete-policy": before-hook-creation,post-install,post-upgrade
    "helm.sh/hook": test,post-install
    "helm.sh/hook-weight": "1"
spec:
  serviceAccountName: {{ include "mysql-chart.serviceAccountName" . }}
  containers:
    - name: ping
      image: "k8s.gcr.io/hyperkube:v1.12.1"
      imagePullPolicy: "IfNotPresent"
      command:
      - /bin/bash
      - -c
      - >
          IP=$(kubectl get pods {{ include "mysql-chart.fullname" . }}-0 -o wide | tail -n 1 | awk '{ print $6 }';);
          ping -c 3 $IP;
          exit $?;
  restartPolicy: Never